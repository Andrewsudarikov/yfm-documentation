# Builder

[@doc-tools/docs](https://www.npmjs.com/package/@doc-tools/docs) позволяет собрать полноценный документационный проект: с навигацией, внутренними переходами и полной поддержкой Yandex Flavored Markdown. Собранный проект представляет собой набор статических HTML, которые можно просмотреть локально или разместить на хостинге, в GitHub Pages или в [S3](https://cloud.yandex.ru/services/storage).

![Пример отображения страницы документации](../../_images/leading.jpg)

## Установка {#install}

```shell
npm i @doc-tools/docs -g
```

## Использование {#use}

Пакет предоставляет команду `yfm` интерфейса командной строки. Для запуска обязательно нужно указать путь до файлов YFM и целевой путь сборки.

```shell script
yfm -i ./input-folder -o ./ouput-folder
```

## Настройки {#settings}

[Настройки YFM](../settings.md) и сборки можно задавать через ключи запуска или описать в [файле конфигурации](../project/config.md) и хранить в самом документационном проекте.

### Основные ключи запуска {#args}

- `--input, -i`

  Путь до директории проекта (обязательный параметр).

- `--output, -o`

  Путь к директории для выходных данных (обязательный параметр).

- `--varsPreset`

  Название используемого [пресета переменных](../project/presets.md).

- `--vars, -v`

  Значения [YFM переменных](../syntax.md#vars)

- `--strict, -s`

  Запуск в строгом режиме.

  Предупреждения YFM трактуются как ошибки. По-умолчанию, выключено.

- `--quiet, -q`

  Запуск в тихом режиме.

  Не выводить логи в stdout. По-умолчанию, выключено.

- `--config, -c`

  Путь до [файла конфигурации YFM](../project/config.md).

- `--output-format`

  Формат генерации: HTML или MD. По-умолчанию, HTML.

- `--apply-presets`

  Подставлять ли значения переменных из [пресетов](../project/presets.md) при конвертации md2md.

- `--add-system-meta`

  Добавить переменные из секции system пресетов в мета-данные файлов. По умолчанию выключено.

- `--remove-hidden-toc-items`
  
  Удалять ли скрытые страницы из результата сборки. По умолчанию выключено.

- `--version`

  Текущая версия.

- `--help`

  Список команд.

Подробнее `yfm-docs --help`

{% note tip "Указание параметров YFM через ключи запуска" %}

Для указания значения [параметра YFM](../settings.md) используйте ключ с таким же названием.

{% endnote %}

## Выкладка на S3

- `--publish`

  Опубликовать сгенерированные файлы в S3. По умолчанию выключено.

  storageEndpoint: string;
  storageBucket: string;
  storagePrefix: string;
  storageKeyId: string;
  storageSecretKey: string;

Builder может самостоятельно выложить собранные файлы в хранилище S3 если указать ключ `--publish`.

Настройки выкладки можно передать через ключи запуска или описать в [файле настроек](../project/config.md).

- `storageEndpoint`

  Endpoint для хранилища S3.

- `storageBucket`

  Bucket для S3.

- `storageKeyId`

  Идентификатор ключа авторизации S3. Кроме параметра запуска и файла настроек можно указать в переменной окружения `YFM_STORAGE_KEY_ID`.

- `storageSecretKey`

  Ключ авторизации S3. Кроме параметра запуска можно указать в переменной окружения `YFM_STORAGE_SECRET_KEY`.

- `storagePrefix`

  Префикс для путей файлов в S3. Необязательный параметр. Если вы хотите складывать в бакет разные версии сборки так, чтобы они не перетирали предыдущие, то можете передавать версию сборки в этом параметре и каждая сборка будет складываться в отдельную папку.

## SinglePage

Вы можете собрать весь проект в виде одного HTML-файла. Для этого укажите ключ `--singlePage`.

{% note warning "Beta-функциональность" %}

Создание одностраничника находится в состоянии бета и может плохо работать на больших проектах со сложной структурой. Вы можете сообщать об обнаруженных проблемах через [GitHub issues](https://github.com/yandex-cloud/yfm-docs/issues).

{% endnote %}

## Трансформация из Markdown в Markdown {#md2md}

По-умолчанию проект собирается в HTML, но можно собрать в markdown с помощью ключа `--output-format=md`.

В этом случае
- будут подставлены [вставки в файлах оглавлений](../project/toc.md#includes);
- вычислены [условия в контенте](../syntax.md#conditions) и в [файлах оглавлений](../project/toc.md#when);
- подставлены [переменные](../syntax.md#vars), если указан параметр `apply-presets`;
- скопированы все файлы, которые указаны в файлах оглавления, используемые в них картинки и [переиспользуемый контент](../syntax.md#includes).

Например, если вы хотите принимать правки в документацию от пользователей, но в коде документации есть разделы с внутренней информацией или разделами не готовыми к публикации, то вы можете держать два репозитория: приватный и публичный, и синхронизировать приватный в публичный запуская трансформацию из markdown в markdown для вырезания нужной информации.
